
on:
  pull_request:
    types: [opened, synchronize, labeled, unlabeled]

permissions:
  contents: read
  id-token: write

jobs:

  testJob:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - id: set_var
        run: |
          content=`cat ./package.json`
          # the following lines are only required for multi line json
          content="${content//'%'/'%25'}"
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
          # end of optional handling for multi line json
          echo "::set-output name=packageJson::$content"
      - run: |
          echo "${{fromJson(steps.set_var.outputs.packageJson).version}}"


  version:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Get version1
        env:
          STAGE_DEV: ${{ vars.STAGE_DEV }}
        shell: bash
        run: |
          echo "STAGE_DEV=$STAGE_DEV"

      - name: Get version2
        #env:
        #  STAGE_DEV: ${{ fromJson(vars.STAGE_DEV).include }}
        shell: bash
        run: |
          echo "STAGE_DEV=${{ fromJson(vars.STAGE_DEV).include[0]['deploy_env'] }}"
#  fastfeedback:
#    uses: ./.github/workflows/external-workflow-fastfeedback.yaml
#
#  extendedtests:
#    uses: ./.github/workflows/external-workflow-exttests.yaml
#    needs: [fastfeedback]
#    with:
#      image_tag: ${{ needs.fastfeedback.outputs.image_tag }}
#      semver: ${{ needs.fastfeedback.outputs.semver }}
##  prod:
##    uses: ./.github/workflows/external-workflow-prod.yaml